---
title: HTTP长连接，短连接和连接池
subtitle: 从一次压测问题说起
date: "2019-05-01"
description: ""
url: /blog/keepalive/
image: "/blog/keepalive/title.jpeg"
---
最近在复盘研究去年压测期间出现的一些网络问题时，重新对HTTP和TCP连接进行了深入学习，也对压测期间觉得"诡异"的问题有了新的理解
<!--more-->
### 问题背景
去年压测期间，在微服务架构下，系统某服务由于客户端（其他业务系统
）调用压力较大，导致连接数过多，出现异常。
* **调用方式**: HTTP长连接调用
* **部署环境**: 阿里云 + Docker
* **负载均衡**: 阿里云SLB（7层结构）
* **异常现象**: 服务端连接数过多，出现异常
* **异常处理**: 将客户端调用由长连接改为短连接后，连接数下降，压力得到缓解，异常消失

问题是得到解决了，但问题**为什么能得到解决**却让我百思不得其解。
按理说长连接能复用连接，短连接不能。但在这儿长连接却使连接数过高，短连接却解决了这个问题，颇有一种："老鼠抓了猫"的讽刺。

提出方案的同学的理由是：**在之前的实践中发现短连接确实在压测中有更好的表现**。具体原因也没给出好的解释。大家提出了各种理论，有怀疑是连接泄漏的，还有怀疑是经过的阿里云SLB带来的问题的等等。但到最后还是不了了之，终究没给出令人信服的答案。

几个月之后，我又偶然间想起了这个问题。这一次我决定从头开始，从TCP出发，弄清楚这个"悬案"

### TCP长连接
众所周知，采用TCP协议进行网络通信时，在真正的读写操作之前，server与client之间必须建立一个连接，这也是我们常说的**"三次握手"**
，当读写操作完成后，双方不再需要这个连接时它们可以释放这个连接，连接的建立是需要三次握手的，而释放则需要4次握手，所以说每个连接的建立都是需要资源消耗和时间消耗的
### HTTP长连接
### 连接池
### Go语言中如何进行HTTP请求
### 总结




